<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <script>
      (function() {
        const APP_VERSION = '2024-12-11-001';
        const storedVersion = localStorage.getItem('sesc_app_version');
        
        if (storedVersion !== APP_VERSION) {
          console.log('üîÑ Nova vers√£o detectada! Limpando cache...');
          localStorage.clear();
          sessionStorage.clear();
          
          if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(registrations => {
              registrations.forEach(reg => reg.unregister());
            });
          }
          
          if ('caches' in window) {
            caches.keys().then(names => {
              names.forEach(name => caches.delete(name));
            });
          }
          
          localStorage.setItem('sesc_app_version', APP_VERSION);
          window.location.reload(true);
        }
      })();
    </script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Cancelamento SESC</title>
    <link rel="stylesheet" href="/styles.css" />
    <link rel="icon" type="image/png" href="/assets/Slogo.png">
  </head>
  <body>
    <div class="app">
      <header class="app-header">
        <div class="brand">
          <div class="title">Cancelamento de Transa√ß√µes</div>
        </div>
        <div class="steps">
          <div class="step-indicator" id="stepIndicator">Dados da solicita√ß√£o/div>
        </div>
      </header>
<div class="container-fecomercio">
  <div class="logo-fecomercio">
    <img src="/assets/fecomercio.png" alt="Fecom√©rcio, SESC e SENAC">
    </div>
</div>
      <main class="card-container">
        <section class="card step active" id="step-1">
          <h2>Dados da solicita√ß√£o</h2>

          <div class="grid-2">
            <label class="field">
              <span>Nome do cliente</span>
              <input
                id="nomeCliente"
                type="text"
                placeholder="Ex: Jo√£o Silva"
              />
            </label>

            <label class="field">
              <span>CPF do cliente</span>
              <input
                id="cpfCliente"
                type="text"
                placeholder="000.000.000-00"
                maxlength="14"
              />
            </label>

            <label class="field">
              <span>Data da solicita√ß√£o</span>
              <input id="dataSolicitacao" type="date" />
            </label>

            <label class="field">
              <span>Caixa</span>
              <input id="caixa" type="number" min="1" placeholder="Caixa que ocorreu a transa√ß√£o"/>
            </label>

            <label class="field">
              <span>N√∫mero da venda (t√≠tulo)</span>
              <input
                id="numeroVenda"
                type="number"
                min="1"
                placeholder="T√≠tulo da venda a ser canceladas"
              />
            </label>

            <label class="field">
              <span>Nome do estabelecimento</span>
              <select id="nomeEstabelecimento">
                <option value="">Selecione...</option>
              </select>
            </label>

            <label class="field">
              <span>C√≥digo do estabelecimento</span>
              <input
                id="codigoEstabelecimento"
                type="text"
                disabled
                placeholder="Preenchido automaticamente"
              />
            </label>

            <label class="field">
              <span>Canal de venda</span>
              <select id="canalVenda">
                <option value="">Selecione...</option>
                <option value="sitef">TEF</option>
                <option value="ecommerce">E-commerce</option>
                <option value="pos">POS</option>
              </select>
            </label>
          </div>

          <div class="actions">
              <button class="btn ghost btn-clear" onclick="limparStepAtual()">
                  Limpar Dados
              </button>
              <button class="btn primary" id="btnNext1">
                Pr√≥ximo
              </button>
          </div>
        </section>

        <section class="card step" id="step-2">
          <h2>Dados SESCNET <img src="/assets/logoSESCNET.png" alt="Logo SescNet" style="height: 20px; vertical-align: middle;"></h2>
          <div class="input-container">
            <h3>Preencha os campos colando os dados do sescnet (CONSULTA T√çTULOS):</h3>
                <textarea id="paste-area" 
        placeholder="Cole aqui os dados tabulados..." 
        style="width:100%; height:80px;"></textarea>
            <div class="columns columns-2-flow">
                <span>Seq</span>
                <input type="text" readonly id="seq" data-col="1" class="col-input" placeholder="Seq">
                <span>Data mvto</span>
                <input type="text" readonly id="data_sescnet" data-col="2" class="col-input" placeholder="Data mvto">
                <span>Caixa</span>
                <input type="text" readonly  data-col="3" class="col-input" placeholder="N caixa">
                <span>Valor pago</span>
                <input type="text" readonly id="valor_sescnet" data-col="4" class="col-input" placeholder="Valor pago">
                <span>Abatimento</span>
                <input type="text" readonly  data-col="5" class="col-input" placeholder="Abatimento">
                <span>Juros</span>
                <input type="text" readonly  data-col="6" class="col-input" placeholder="Juros">
                <span>Multa</span>
                <input type="text" readonly  data-col="7" class="col-input" placeholder="Multa">
                
                <span>Outros Pgto</span>
                <input type="text" readonly data-col="8" class="col-input" placeholder="Outros Pgto">
                
                <span>Total geral</span>
                <input type="text" readonly  data-col="9" class="col-input" placeholder="Total geral">
                <span>Tipo de liquida√ß√£o</span>
                <input type="text" readonly  data-col="10" class="col-input" placeholder="Tipo de liquida√ß√£o">
                <span>Opera√ß√£o cont√°bil</span>
                <input type="text" readonly  data-col="11" class="col-input" placeholder="Op Cont√°bil">
                <span>N de parcelas</span>
                <input type="text" readonly  data-col="12" class="col-input" placeholder="N√∫mero de parcelas">
                <span>NSU (TEF)</span>
                <input type="text" readonly id="nsu_tef" data-col="13" class="col-input" placeholder="TEF - NSU">
                <span>NSU (web)</span>
                <input type="text" readonly id="nsu_web" data-col="14" class="col-input" placeholder="WEB - NSU">
                <span>TID</span>
                <input type="text" readonly id="tid" data-col="15" class="col-input" placeholder="TID">
                
                </div>
</div>


          
        <div class="actions">
            <button class="btn ghost btn-clear" onclick="limparStepAtual()">
                Limpar Dados
            </button>
            <button class="btn ghost" onclick="voltar(1)">Voltar
            </button>
            <button class="btn primary" id="btnNext2">
                Pr√≥ximo
            </button>
        </div>
        </section>

        <section class="card step" id="step-3">
          <h2>SiTef ‚Äî vers√£o</h2>
          <p class="muted">Escolha a vers√£o usada.</p>

          <div class="sitef-choices">
            <button class="btn tile" id="sitefWeb">
              <img src="/assets/sitefantigo.jpg" alt="Logo SiTef Web" style="height: 30px; margin-bottom: 8px;"><br>
              SiTef Web (Antigo)
            </button>
            <button class="btn tile" id="sitefExpress">
              <img src="/assets/sitefnovo.jpg" alt="Logo SiTef Express" style="height: 30px; margin-bottom: 8px;"><br>
              SiTef Express (Novo)
            </button>
          </div>

        <div class="actions">
            <button class="btn ghost btn-clear" onclick="limparStepAtual()">
                Limpar Dados
            </button>
            <button class="btn ghost" onclick="voltar(1)">Voltar
            </button>
            <button class="btn primary" id="btnNext3">
                Pr√≥ximo
            </button>
        </div>
        </section>

        <section class="card step" id="step-4">
          <h2>SiTef Web (antigo) - Relat√≥rio Tabular <img src="/assets/sitefantigo.jpg" alt="Logo SiTef Web" style="height: 20px; vertical-align: middle;"></h2>
          <p class="muted">Cole a linha de dados tabulados do relat√≥rio do SiTef.</p>
          <div class="input-container">
            <textarea
              id="sitefWebInput"
              placeholder="Cole a linha de dados tabulados (Loja  Data  Hora  PDV NSU...)"
              style="width: 100%; height: 80px"
            ></textarea>
            
            <div class="columns-sitef-web columns-2-flow">
              <span>Nome da Coluna</span>
              <span>Valor Colado</span>

              <span class="label">Loja</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="Loja">

              <span class="label">Data</span>
              <input type="text" readonly id="data_sitef" class="col-input-sitef-web" placeholder="Data (YYYYMMDD)">

              <span class="label">Hora</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="Hora">

              <span class="label">PDV</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="PDV">

              <span class="label">NSU</span>
              <input type="text" readonly id="nsu_sitef" class="col-input-sitef-web" placeholder="NSU">

              <span class="label">NSU Host</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="NSU Host">
              
              <span class="label">Rede</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="Rede">
              
              <span class="label">Produto</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="Produto">

              <span class="label">Transa√ß√£o</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="Transa√ß√£o">
              
              <span class="label">Documento</span>
              <input type="text" readonly id="n_cartao" class="col-input-sitef-web" placeholder="N√∫mero do Cart√£o">
              
              <span class="label">Valor</span>
              <input type="text" readonly id="valor_sitef" class="col-input-sitef-web" placeholder="Valor">
              
              <span class="label">Estado Transa√ß√£o</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="Estado Transa√ß√£o">
              
              <span class="label">Cod. Resp.</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="Cod. Resp.">
              
              <span class="label">Doc Cancel</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="Doc Cancel">
              
              <span class="label">C√≥d. Autor</span>
              <input type="text" readonly id="aut" class="col-input-sitef-web" placeholder="C√≥d. Autor">

              <span class="label">No. Parc.</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="No. Parc.">

              <span class="label">Data do lanc</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="Data do lanc">

              <span class="label">Usu√°rio Pend</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="Usu√°rio Pend">

              <span class="label">Data Pend</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="Data Pend">

              <span class="label">Hora Pend</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="Hora Pend">

              <span class="label">Tempo Resp. Rede</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="Tempo Resp. Rede">

              <span class="label">Bandeira</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="Bandeira">

              <span class="label">Term. L√≥gico</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="Term. L√≥gico">

              <span class="label">Operador</span>
              <input type="text" readonly class="col-input-sitef-web" placeholder="Operador">
            </div>
          </div>

          <div class="actions">
              <button class="btn ghost btn-clear" onclick="limparStepAtual()">
                  Limpar Dados
              </button>
              <button class="btn ghost" onclick="voltar(1)">Voltar
              </button>
              <button class="btn primary" id="btnNext4">
                  Pr√≥ximo
              </button>
          </div>
        </section>

        <section class="card step" id="step-5">
  <h2>SiTef Express (novo) <img src="/assets/sitefnovo.jpg" alt="Logo SiTef Express" style="height: 20px; vertical-align: middle;"></h2>
  <p class="muted">Cole as informa√ß√µes do SiTef Express (Consulta t√≠tulos).</p>

  <div class="input-container">
    <textarea
      id="sitefExpressInput"
      placeholder="Cole aqui os dados de duas colunas (Nome: Valor)..."
      style="width: 100%; height: 80px"
    ></textarea>

    <div class="columns-sitef-express columns-2-flow">
      <span>Nome da Vari√°vel</span>
      <span>Valor Colado</span>

      <span class="label">Data</span>
      <input type="text" readonly id="data_sitef_express" class="col-input-sitef" placeholder="Data (Apenas Data)">

      <span class="label">Loja</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Loja">

      <span class="label">C√≥digo Loja</span>
      <input type="text" readonly class="col-input-sitef" placeholder="C√≥digo Loja">

      <span class="label">Cart√£o</span>
      <input type="text" readonly id="n_cartao_express" class="col-input-sitef" placeholder="xxxxxx******xxxx">

      <span class="label">PDV</span>
      <input type="text" readonly class="col-input-sitef" placeholder="PDV">

      <span class="label">NSU</span>
      <input type="text" readonly id="nsu_sitef_express" class="col-input-sitef" placeholder="NSU">

      <span class="label">NSU Host</span>
      <input type="text" readonly class="col-input-sitef" placeholder="NSU Host">

      <span class="label">NSU Host Aux</span>
      <input type="text" readonly class="col-input-sitef" placeholder="NSU Host Aux">

      <span class="label">Valor</span>
      <input type="text" readonly id="valor_sitef_express" class="col-input-sitef" placeholder="Valor">

      <span class="label">Rede</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Rede">

      <span class="label">Tipo Produto</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Tipo Produto">

      <span class="label">Concilia√ß√£o</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Concilia√ß√£o">

      <span class="label">C√≥digo Autoriza√ß√£o</span>
      <input type="text" readonly id="aut_express" class="col-input-sitef" placeholder="C√≥digo Autoriza√ß√£o">

      <span class="label">Estabelecimento</span>
      <input type="text" readonly id="estab_sitef" class="col-input-sitef" placeholder="Estabelecimento">

      <span class="label">Modo Entrada</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Modo Entrada">

      <span class="label">Cupom Fiscal</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Cupom Fiscal">

      <span class="label">Data Fiscal</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Data Fiscal">

      <span class="label">Produto</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Produto">

      <span class="label">Descritivo Transa√ß√£o</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Descritivo Transa√ß√£o">

      <span class="label">N¬∫. Parcelas</span>
      <input type="text" readonly class="col-input-sitef" placeholder="N¬∫. Parcelas">

      <span class="label">Usu√°rio Pend√™ncia</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Usu√°rio Pend√™ncia">

      <span class="label">C√≥d. Cliente</span>
      <input type="text" readonly class="col-input-sitef" placeholder="C√≥d. Cliente">

      <span class="label">PSP</span>
      <input type="text" readonly class="col-input-sitef" placeholder="PSP">

      <span class="label">Num. Pula Ciclos</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Num. Pula Ciclos">

      <span class="label">C√≥digo Operador</span>
      <input type="text" readonly class="col-input-sitef" placeholder="C√≥digo Operador">

      <span class="label">Resp. Rede</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Resp. Rede">

      <span class="label">Data da pend√™ncia</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Data da pend√™ncia">

      <span class="label">Supervisor</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Supervisor">

      <span class="label">Flag de on/off</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Flag de on/off">

      <span class="label">Plano</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Plano">

      <span class="label">Ident. Dossie</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Ident. Dossie">

      <span class="label">Tipo do Cart√£o</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Tipo do Cart√£o">

      <span class="label">Cod. SiTef</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Cod. SiTef">

      <span class="label">Terminal Logico</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Terminal Logico">

      <span class="label">Descri√ß√£o da Loja</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Descri√ß√£o da Loja">

      <span class="label">Formas de Pagamento</span>
      <input type="text" readonly class="col-input-sitef" placeholder="Formas de Pagamento">
    </div>
  </div>

          <div class="actions">
              <button class="btn ghost btn-clear" onclick="limparStepAtual()">
                  Limpar Dados
              </button>
              <button class="btn ghost" onclick="voltar(1)">Voltar
              </button>
              <button class="btn primary" id="btnNext5">
                  Pr√≥ximo
              </button>
          </div>
</section>

        <section class="card step" id="step-6">
          <h2>Valor a cancelar + resumo da solicita√ß√£o</h2>

          <label class="field">
            <span>Valor a cancelar</span>
            <input id="valorCancelar" placeholder="R$ 0,00" />
          </label>

          <div class="summary card-summary" id="summaryBox"></div>

          <div class="actions">
            <button class="btn ghost" onclick="voltar(
              state.canalVenda === 'sitef' 
                ? (state.sitefType === 'web' ? 4 : 5) 
                : 2
            )"> Voltar
            </button>
            <button class="btn success" id="btnGenerate">Baixar arquivo</button>
          </div>
        </section>
      </main>

      <footer class="app-footer"></footer>
    </div>

    <section class="tutorial-card">
      <h2>Tutoriais</h2>
      <p>Em breve, links √∫teis e orienta√ß√µes estar√£o listados aqui.</p>
    </section>
  </div>

  <div id="modal" class="modal hidden">
    <div class="modal-content">
      <h3 id="modal-title">T√≠tulo</h3>
      <p id="modal-message"></p>
      <div class="modal-actions">
        <button id="modal-ok" class="choose-btn">OK</button>
      </div>
    </div>
  </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>

    <script src="/scripts/script.js"></script>
  </body>
</html>